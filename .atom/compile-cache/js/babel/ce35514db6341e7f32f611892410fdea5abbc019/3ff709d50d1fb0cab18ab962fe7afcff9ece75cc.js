"use babel";

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.activate = activate;
exports.deactivate = deactivate;
exports.handleURI = handleURI;
exports.deserialize = deserialize;
var path = null;
var PdfEditorView = null;
var querystring = null;
var subscriptions = null;

var _require = require('atom');

var CompositeDisposable = _require.CompositeDisposable;

function activate(state) {
  subscriptions = new CompositeDisposable(atom.workspace.addOpener(openUri), atom.packages.onDidActivateInitialPackages(createPdfStatusView), atom.config.observe('pdf-view.fileExtensions', updateFileExtensions), atom.commands.add('atom-workspace', 'pdf-view:toggle-binary-view', toggleBinaryView));
}

function deactivate() {
  if (subscriptions) {
    subscriptions.dispose();
  }
}

function handleURI(parsedUri) {
  var query = Object.assign({}, parsedUri.query);

  if (parsedUri.hash) {
    // Allow query parameters to exist in hash to main compatability with Adobe
    // PDF style urls.
    if (parsedUri.hash.includes('=')) {
      if (querystring === null) {
        querystring = require('querystring');
      }

      Object.assign(query, querystring.parse(parsedUri.hash.substring(1)));
    } else {
      query.nameddest = parsedUri.hash.substring(1);
    }
  }

  var filePath = query.path || pathnameToFilePath(parsedUri.pathname);

  atom.workspace.open(filePath).then(function (view) {
    if (view) {
      if (query.source && query.line) {
        view.forwardSync(query.source, query.line);
      } else if (query.page) {
        view.scrollToPage(query.page);
      } else if (query.nameddest) {
        view.scrollToNamedDest(query.nameddest);
      }
    }
  });
}

function pathnameToFilePath(pathname) {
  var filePath = decodeURI(pathname || '');

  if (process.platform === 'win32') {
    filePath = filePath.replace(/\//g, '\\').replace(/^(.+)\|/, '$1:').replace(/\\([A-Z]:\\)/, '$1');
  } else if (!filePath.startsWith('/')) {
    filePath = '/' + filePath;
  }

  return filePath;
}

// Files with these extensions will be opened as PDFs
var pdfExtensions = new Set();

function updateFileExtensions(extensions) {
  pdfExtensions.clear();
  for (var extension of extensions) {
    extension = extension.toLowerCase().replace(/^\.*/, '.');
    pdfExtensions.add(extension);
  }
}

function openUri(uriToOpen) {
  if (path === null) {
    path = require('path');
  }

  var uriExtension = path.extname(uriToOpen).toLowerCase();
  if (pdfExtensions.has(uriExtension)) {
    if (PdfEditorView === null) {
      PdfEditorView = require('./pdf-editor-view');
    }
    return new PdfEditorView(uriToOpen);
  }
}

function toggleBinaryView() {
  if (PdfEditorView === null) {
    PdfEditorView = require('./pdf-editor-view');
  }
  var paneItem = atom.workspace.getActivePaneItem();
  if (!paneItem || !(paneItem instanceof PdfEditorView)) {
    return;
  }
  paneItem.binaryView = !paneItem.binaryView;
}

function createPdfStatusView() {
  var PdfStatusBarView = require('./pdf-status-bar-view');
  new PdfStatusBarView();
  var PdfGoToPageView = require('./pdf-goto-page-view');
  new PdfGoToPageView();
}

function deserialize(_ref) {
  var filePath = _ref.filePath;
  var scale = _ref.scale;
  var scrollTop = _ref.scrollTop;
  var scrollLeft = _ref.scrollLeft;

  if (require('fs-plus').isFileSync(filePath)) {
    if (PdfEditorView === null) {
      PdfEditorView = require('./pdf-editor-view');
    }
    return new PdfEditorView(filePath, scale, scrollTop, scrollLeft);
  } else {
    console.warn("Could not deserialize PDF editor for path '#{filePath}' because that file no longer exists");
  }
}

if (parseFloat(atom.getVersion()) < 1.7) {
  atom.deserializers.add({
    "name": "PdfEditorDeserializer",
    "deserialize": deserialize
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FoMjU3OTYyLy5hdG9tL3BhY2thZ2VzL3BkZi12aWV3L2xpYi9wZGYtZWRpdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQzs7Ozs7Ozs7O0FBRVosSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQ2hCLElBQUksYUFBYSxHQUFHLElBQUksQ0FBQztBQUN6QixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUM7QUFDdkIsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDOztlQUNLLE9BQU8sQ0FBQyxNQUFNLENBQUM7O0lBQXRDLG1CQUFtQixZQUFuQixtQkFBbUI7O0FBRW5CLFNBQVMsUUFBUSxDQUFDLEtBQUssRUFBRTtBQUM5QixlQUFhLEdBQUcsSUFBSSxtQkFBbUIsQ0FDckMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQ2pDLElBQUksQ0FBQyxRQUFRLENBQUMsNEJBQTRCLENBQUMsbUJBQW1CLENBQUMsRUFDL0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMseUJBQXlCLEVBQUUsb0JBQW9CLENBQUMsRUFDcEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsNkJBQTZCLEVBQUUsZ0JBQWdCLENBQUMsQ0FDckYsQ0FBQztDQUNIOztBQUVNLFNBQVMsVUFBVSxHQUFHO0FBQzNCLE1BQUksYUFBYSxFQUFFO0FBQ2pCLGlCQUFhLENBQUMsT0FBTyxFQUFFLENBQUM7R0FDekI7Q0FDRjs7QUFFTSxTQUFTLFNBQVMsQ0FBQyxTQUFTLEVBQUU7QUFDbkMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFBOztBQUVoRCxNQUFJLFNBQVMsQ0FBQyxJQUFJLEVBQUU7OztBQUdsQixRQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ2hDLFVB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Q0FDRjs7QUFFRCxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUU7QUFDdkMsTUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUM7QUFDckIsVUFBTSxFQUFFLHVCQUF1QjtBQUMvQixpQkFBYSxFQUFFLFdBQVc7R0FDM0IsQ0FBQyxDQUFDO0NBQ0oiLCJmaWxlIjoiL2hvbWUvYWgyNTc5NjIvLmF0b20vcGFja2FnZXMvcGRmLXZpZXcvbGliL3BkZi1lZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBiYWJlbFwiO1xuXG5sZXQgcGF0aCA9IG51bGw7XG5sZXQgUGRmRWRpdG9yVmlldyA9IG51bGw7XG5sZXQgcXVlcnlzdHJpbmcgPSBudWxsO1xubGV0IHN1YnNjcmlwdGlvbnMgPSBudWxsO1xuY29uc3Qge0NvbXBvc2l0ZURpc3Bvc2FibGV9ID0gcmVxdWlyZSgnYXRvbScpO1xuXG5leHBvcnQgZnVuY3Rpb24gYWN0aXZhdGUoc3RhdGUpIHtcbiAgc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKFxuICAgIGF0b20ud29ya3NwYWNlLmFkZE9wZW5lcihvcGVuVXJpKSxcbiAgICBhdG9tLnBhY2thZ2VzLm9uRGlkQWN0aXZhdGVJbml0aWFsUGFja2FnZXMoY3JlYXRlUGRmU3RhdHVzVmlldyksXG4gICAgYXRvbS5jb25maWcub2JzZXJ2ZSgncGRmLXZpZXcuZmlsZUV4dGVuc2lvbnMnLCB1cGRhdGVGaWxlRXh0ZW5zaW9ucyksXG4gICAgYXRvbS5jb21tYW5kcy5hZGQoJ2F0b20td29ya3NwYWNlJywgJ3BkZi12aWV3OnRvZ2dsZS1iaW5hcnktdmlldycsIHRvZ2dsZUJpbmFyeVZpZXcpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgIHN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVVUkkocGFyc2VkVXJpKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gT2JqZWN0LmFzc2lnbih7fSwgcGFyc2VkVXJpLnF1ZXJ5KVxuXG4gIGlmIChwYXJzZWRVcmkuaGFzaCkge1xuICAgIC8vIEFsbG93IHF1ZXJ5IHBhcmFtZXRlcnMgdG8gZXhpc3QgaW4gaGFzaCB0byBtYWluIGNvbXBhdGFiaWxpdHkgd2l0aCBBZG9iZVxuICAgIC8vIFBERiBzdHlsZSB1cmxzLlxuICAgIGlmIChwYXJzZWRVcmkuaGFzaC5pbmNsdWRlcygnPScpKSB7XG4gICAgICBpZiAocXVlcnlzdHJpbmcgPT09IG51bGwpIHtcbiAgICAgICAgcXVlcnlzdHJpbmcgPSByZXF1aXJlKCdxdWVyeXN0cmluZycpXG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5hc3NpZ24ocXVlcnksIHF1ZXJ5c3RyaW5nLnBhcnNlKHBhcnNlZFVyaS5oYXNoLnN1YnN0cmluZygxKSkpXG4gICAgfSBlbHNlIHtcbiAgICAgIHF1ZXJ5Lm5hbWVkZGVzdCA9IHBhcnNlZFVyaS5oYXNoLnN1YnN0cmluZygxKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGZpbGVQYXRoID0gcXVlcnkucGF0aCB8fCBwYXRobmFtZVRvRmlsZVBhdGgocGFyc2VkVXJpLnBhdGhuYW1lKVxuXG4gIGF0b20ud29ya3NwYWNlLm9wZW4oZmlsZVBhdGgpLnRoZW4odmlldyA9PiB7XG4gICAgaWYgKHZpZXcpIHtcbiAgICAgIGlmIChxdWVyeS5zb3VyY2UgJiYgcXVlcnkubGluZSkge1xuICAgICAgICB2aWV3LmZvcndhcmRTeW5jKHF1ZXJ5LnNvdXJjZSwgcXVlcnkubGluZSlcbiAgICAgIH0gZWxzZSBpZiAocXVlcnkucGFnZSkge1xuICAgICAgICB2aWV3LnNjcm9sbFRvUGFnZShxdWVyeS5wYWdlKVxuICAgICAgfSBlbHNlIGlmIChxdWVyeS5uYW1lZGRlc3QpIHtcbiAgICAgICAgdmlldy5zY3JvbGxUb05hbWVkRGVzdChxdWVyeS5uYW1lZGRlc3QpXG4gICAgICB9XG4gICAgfVxuICB9KVxufVxuXG5mdW5jdGlvbiBwYXRobmFtZVRvRmlsZVBhdGgocGF0aG5hbWUpIHtcbiAgbGV0IGZpbGVQYXRoID0gZGVjb2RlVVJJKHBhdGhuYW1lIHx8ICcnKVxuXG4gIGlmIChwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInKSB7XG4gICAgZmlsZVBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKC9cXC8vZywgJ1xcXFwnKS5yZXBsYWNlKC9eKC4rKVxcfC8sICckMTonKS5yZXBsYWNlKC9cXFxcKFtBLVpdOlxcXFwpLywgJyQxJylcbiAgfSBlbHNlIGlmICghZmlsZVBhdGguc3RhcnRzV2l0aCgnLycpKSB7XG4gICAgZmlsZVBhdGggPSBgLyR7ZmlsZVBhdGh9YFxuICB9XG5cbiAgcmV0dXJuIGZpbGVQYXRoXG59XG5cbi8vIEZpbGVzIHdpdGggdGhlc2UgZXh0ZW5zaW9ucyB3aWxsIGJlIG9wZW5lZCBhcyBQREZzXG5jb25zdCBwZGZFeHRlbnNpb25zID0gbmV3IFNldCgpO1xuXG5mdW5jdGlvbiB1cGRhdGVGaWxlRXh0ZW5zaW9ucyhleHRlbnNpb25zKSB7XG4gIHBkZkV4dGVuc2lvbnMuY2xlYXIoKTtcbiAgZm9yIChsZXQgZXh0ZW5zaW9uIG9mIGV4dGVuc2lvbnMpIHtcbiAgICBleHRlbnNpb24gPSBleHRlbnNpb24udG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9eXFwuKi8sICcuJyk7XG4gICAgcGRmRXh0ZW5zaW9ucy5hZGQoZXh0ZW5zaW9uKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBvcGVuVXJpKHVyaVRvT3Blbikge1xuICBpZiAocGF0aCA9PT0gbnVsbCkge1xuICAgIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG4gIH1cblxuICBsZXQgdXJpRXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKHVyaVRvT3BlbikudG9Mb3dlckNhc2UoKVxuICBpZiAocGRmRXh0ZW5zaW9ucy5oYXModXJpRXh0ZW5zaW9uKSkge1xuICAgIGlmIChQZGZFZGl0b3JWaWV3ID09PSBudWxsKSB7XG4gICAgICBQZGZFZGl0b3JWaWV3ID0gcmVxdWlyZSgnLi9wZGYtZWRpdG9yLXZpZXcnKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQZGZFZGl0b3JWaWV3KHVyaVRvT3Blbik7XG4gIH1cbn1cblxuZnVuY3Rpb24gdG9nZ2xlQmluYXJ5VmlldygpIHtcbiAgaWYoUGRmRWRpdG9yVmlldyA9PT0gbnVsbCkge1xuICAgIFBkZkVkaXRvclZpZXcgPSByZXF1aXJlKCcuL3BkZi1lZGl0b3ItdmlldycpO1xuICB9XG4gIGNvbnN0IHBhbmVJdGVtID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlUGFuZUl0ZW0oKTtcbiAgaWYoIXBhbmVJdGVtIHx8ICEocGFuZUl0ZW0gaW5zdGFuY2VvZiBQZGZFZGl0b3JWaWV3KSkge1xuICAgIHJldHVybjtcbiAgfVxuICBwYW5lSXRlbS5iaW5hcnlWaWV3ID0gIXBhbmVJdGVtLmJpbmFyeVZpZXc7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVBkZlN0YXR1c1ZpZXcoKSB7XG4gIGxldCBQZGZTdGF0dXNCYXJWaWV3ID0gcmVxdWlyZSgnLi9wZGYtc3RhdHVzLWJhci12aWV3Jyk7XG4gIG5ldyBQZGZTdGF0dXNCYXJWaWV3KCk7XG4gIGxldCBQZGZHb1RvUGFnZVZpZXcgPSByZXF1aXJlKCcuL3BkZi1nb3RvLXBhZ2UtdmlldycpO1xuICBuZXcgUGRmR29Ub1BhZ2VWaWV3KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXNlcmlhbGl6ZSh7ZmlsZVBhdGgsIHNjYWxlLCBzY3JvbGxUb3AsIHNjcm9sbExlZnR9KSB7XG4gIGlmIChyZXF1aXJlKCdmcy1wbHVzJykuaXNGaWxlU3luYyhmaWxlUGF0aCkpIHtcbiAgICBpZiAoUGRmRWRpdG9yVmlldyA9PT0gbnVsbCkge1xuICAgICAgUGRmRWRpdG9yVmlldyA9IHJlcXVpcmUoJy4vcGRmLWVkaXRvci12aWV3Jyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUGRmRWRpdG9yVmlldyhmaWxlUGF0aCwgc2NhbGUsIHNjcm9sbFRvcCwgc2Nyb2xsTGVmdCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGRlc2VyaWFsaXplIFBERiBlZGl0b3IgZm9yIHBhdGggJyN7ZmlsZVBhdGh9JyBiZWNhdXNlIHRoYXQgZmlsZSBubyBsb25nZXIgZXhpc3RzXCIpO1xuICB9XG59XG5cbmlmIChwYXJzZUZsb2F0KGF0b20uZ2V0VmVyc2lvbigpKSA8IDEuNykge1xuICBhdG9tLmRlc2VyaWFsaXplcnMuYWRkKHtcbiAgICBcIm5hbWVcIjogXCJQZGZFZGl0b3JEZXNlcmlhbGl6ZXJcIixcbiAgICBcImRlc2VyaWFsaXplXCI6IGRlc2VyaWFsaXplXG4gIH0pO1xufVxuIl19